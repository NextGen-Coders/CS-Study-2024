# 🪙 JWT(Json Web Token)

## 👛목차

1. JWT 란?
2. JWT 사용 이유
2. JWT 구조
3. JWT를 통한 인증/인가
4. JWT 장점과 한계
5. JWT 사용 시 주의 사항

<br>

## 🏝️ JWT 란?

JWT(Json Web Token)은 Json 객체에 인증에 필요한 정보들을 담은 후 비밀키로 서명한 토큰으로, 인터넷 표준 인증 방식이다. 공식적으로 인증(Authentication) & 권한허가(Authorization) 방식으로 사용됩니다.

JWT 토큰 웹에서 보통 Authorization HTTP 헤더를 Bearer <토큰>의 형태로 설정하여 클라이언트에서 서버로 전송되며, 서버에서는 토큰에 포함되어 있는 서명(signature) 정보를 통해서 위변조 여부를 빠르게 검증할 수 있게 됩니다.

JWT 토큰은 Base64로 인코딩이 되어 있어서 육안으로 보면 eyJ로 시작하는 아주 긴 문자열인데요. 온라인 디버거를 통해서 어렵지 않게 실제로 저장되어 있는 내용을 JSON 형태로 디코딩하여 확인해볼 수 있습니다.

<br>

## 🩴JWT 사용 이유

HTTP는 기본적으로 `state-less`를 지향합니다.

#### state-less(무상태)란?
서버-클라이언트 구조에서 서버가 클라이언트의 상태를 가지고 있지 않는 것

#### 👍http 장점

서버의 확장성이 높으며 대량의 트래픽이 발생해도 대처할 수 있습니다.

#### 👎http 단점

1. state-ful 방식보다 비교적 많은 양의 데이터가 반복적으로 전송되므로 네트워크 성능저하가 될 수 있습니다.
2. 데이터 노출로 인한 보안적인 문제가 존재합니다.
 

→이 단점을 보완하기 위해 JWT로 데이터 압축 및 암호화를 위하여 JWT를 사용한다.

<br>

## 🪢JWT 구조

하나의 JWT 토큰은 헤더(header)와 페이로드(payload), 서명(signature) 이렇게 세 부분으로 이루어지며, 각 구역이 . 기호로 구분됩니다.
```
aaaaaaa.bbbbbbb.ccccccc //헤더.페이로드.시그니처
```

각 역할은 다음과 같습니다.
- 헤더: 토큰 타입, 암호화 알고리즘 명시
- 페이로드: JWT에 넣을 데이터, JWT 발급 / 만료일 등 명시
- 시그니처: 헤더, 페이로드가 변조 되었는지를 확인하는 역할

첫 번째 부분인 헤더(header)에는 토큰의 유형과 서명 알고리즘에 명시되고, 중간 부분인 페이로드(payload)에는 소위 claim이라고도 불리는 사용자의 인증/인가 정보가 담기는데요. 마지막 부분인 서명(signature)에는 헤더와 페이로드가 비밀키로 서명되어 저장됩니다.

JWT 토큰은 네트워크로 전송되야 하기 때문에 공간을 적게 차지하는 것이 유리한데요. 그래서 독특하게도 JSON 형식으로 데이터를 저장할 때 키(key)를 3글자로 줄이는 관행이 있습니다.

아래는 전형적인 JWT 토큰의 디코딩 결과입니다.

헤더
```
{
  "alg": "HS256",
  "typ": "JWT"
}
```
페이로드
```
{
  "sub": "1234567890",
  "lat": 1516239022
}
```

### JSON 키

JWT에서 자주 사용되는 JSON 키 이름은 다음과 같습니다.

- `sub` 키: 인증 주체(subject)
- `iss` 키: 토큰 발급처
- `typ` 키: 토큰의 유형(type)
- `alg` 키: 서명 알고리즘(algorithm)
- `iat` 키: 발급 시각(issued at)
- `exp` 키: 말료 시작(expiration time)
- `aud` 키: 클라이언트(audience)

<br>

## 🛢️JWT를 통한 인증/인가

JWT는 실무에서 OAuth나 OIDC 프로토콜과 함께 API의 인증이나 인가를 위해서 주로 사용됩니다.

보통 클라이언트가 어떤 서비스의 인가 서버를 통해 로그인에 성공하면 JWT 토큰을 획득할 수 있는데, 그러면 클라이언트는 해당 서비스의 API를 호출할 때 JWT 토큰을 보내서 원하는 자원에 접근하거나 허용된 작업을 수행할 수 있게 됩니다.

<br>

## 🐒JWT 장점과 한계

### 👍JWT의 장점

JWT가 등장하기 전에는 웹에서 쿠키(cookie)와 세션(session)을 이용한 사용자 인증을 구현하는 경우가 많았습니다. 쿠키와 세션은 서버 단에 로그인한 모든 사용자의 세션을 DB나 캐시(cache)에 저장해놓고 쿠키로 넘어온 세션 ID로 사용자 데이터를 매번 조회해야 합니다.

JWT는 토큰 자체에 사용자의 정보가 저장되어 있어있기 때문에 서버 입장에서 토큰을 검증만 해주면 됩니다. 따라서 사용자가 늘어나더라도 사용자 인증을 위해서 추가로 투자해야하는 인프라 비용을 크게 절감할 수 있습니다.

뿐만 아니라 쿠키를 사용하지 않으므로 CORS 문제에서 자유로워진다는 것도 장점으로 여겨질 수 있겠습니다.

### 😭JWT의 한계

위와 같은 JWT의 장점에도 불구하고 어느 정도 규모가 있는 서비스에서 사용자 인증 용도로 JWT를 사용하기에는 부족한 경우가 있는데요.

예를 들어, 현재 로그인된 사용자의 모든 장비들을 나열해주거나, 특정 장비에서 로그아웃을 허용하는 기능을 구현하려면 서버 단에 사용자 세션을 저장하지 않고는 어렵기 때문입니다.

<br>

## 👮‍♂️JWT 사용 시 주의 사항

서명이 되어 있는 JWT 토큰 서버에서만 유효성을 검증할 수 있지만, 그 안에 저장된 데이터는 누구나 쉽게 열람이 가능합니다. 따라서 민감한 사용자 정보를 JWT 토큰에 그대로 저장하게 되면, 큰 보안 문제로 이어질 수 있기 때문에 주의가 필요합니다.

가급적 JWT 토큰에는 사용자를 식별할 수 있는 아이디 정도만 저장하는 것이 좋으며, 해당 사용자에 대한 추가 정보가 필요한 경우에는 서버에서 사용자 DB를 조회하는 것이 안전합니다. 불가피한 이유로 JWT 토큰에 민감한 사용자 정보를 저장해야한다면, 반드시 암호화를 하여 JWT 토큰을 디코딩한 후에도 알아볼 수 없도록 하는 것이 좋습니다.

<br>

---

### 📌 Reference  

- [우리는 왜 JWT를 사용하는가? / JWT 사용 이유](https://puleugo.tistory.com/138)

- [JWT (JSON Web Token) 이해와 활용](http://www.opennaru.com/opennaru-blog/jwt-json-web-token/)

- [JWT(Json Web Token) 알아가기](https://brunch.co.kr/@jinyoungchoi95/1)

- [JWT - Json Web Token](https://www.daleseo.com/jwt/)

- [😎 알고 쓰자, JWT(Json Web Token).](https://velog.io/@chuu1019/%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-JWTJson-Web-Token)