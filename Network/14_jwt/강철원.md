# 📌 JWT       

JWT(Json Web Token) 말 그대로 웹에서 사용되는 JSON 형식의 토큰에 대한 표준 규격인데 주로 사용자의 인증또는 인가정보를 서버와 클라이언트간에 안전하게 주고 받기 위해서 사용됩니다.  

조금 더 알기 쉽게 간단한 이야기를 통해 JWT에대해 알아보겠습니다.

옛날 옛적에, 멀고 먼 디지털 왕국에는 정보를 안전하게 전달하는 방법을 찾고 있는 많은 사람들이 살고 있었습니다. 이 왕국에는 다양한 정보가 존재했는데, 중요한 문서부터 사소한 노트까지 모두 중요한 역할을 했습니다. 왕국 사람들은 이 정보를 왕국의 다른 곳으로 안전하게 보내고 싶어 했지만, 도중에 나쁜 해커들이 정보를 훔치거나 변경하는 일이 빈번히 발생했습니다.

그러던 어느 날, JSON Web Token(JWT)이라는 마법사가 나타났습니다. JWT 마법사는 정보를 작은 메시지로 변환하는 특별한 마법을 가지고 있었습니다. 이 메시지는 세 부분으로 나뉘었습니다. 첫 번째 부분은 '헤더'라 불리며, 메시지가 어떤 마법(알고리즘)으로 보호되는지 알려주었습니다. 두 번째 부분은 '페이로드'라 하여, 전달하고자 하는 실제 정보(주장)를 담고 있었습니다. 마지막 세 번째 부분은 '서명'이라 불리며, 메시지가 변경되지 않았음을 증명하는 마법의 인장이었습니다.

JWT 마법사는 이 메시지를 생성할 때, 자신만의 비밀 키 또는 공개 키와 비밀 키 쌍을 사용하여 서명했습니다. 이 서명 덕분에, 메시지를 받는 이들은 메시지가 진짜 JWT 마법사로부터 온 것이며, 도중에 변경되지 않았음을 확신할 수 있었습니다.

왕국 사람들은 이 마법을 사용하여 중요한 정보를 전달하기 시작했습니다. 예를 들어, 왕국의 문지기는 성문을 지키며, 들어오려는 이들이 제대로 된 JWT 메시지를 가지고 있는지 확인했습니다. 올바른 메시지를 가진 자만이 성 안으로 들어갈 수 있었고, 이는 왕국을 더욱 안전하게 만들었습니다.

JWT 마법사는 또한, 메시지가 너무 오랫동안 사용되지 않도록 '만료 시간'을 설정하는 마법도 가르쳐 주었습니다. 이로 인해, 오래된 메시지는 더 이상 유효하지 않게 되어, 나쁜 마음을 가진 이들이 오래된 메시지를 재사용하는 일을 방지할 수 있었습니다.

그 덕분에 왕국은 정보를 더욱 안전하고 효율적으로 주고받을 수 있게 되었고, 모든 사람들은 JWT 마법사의 마법에 감사하며 행복하게 살았습니다. 정보를 안전하게 전달하는 문제는 영원히 해결되었고, 왕국은 평화롭게 번영을 이어갔습니다.

<br>

## 📌 토큰이 무엇이며 왜 필요한가?

위에서도 설명드렸지만 인증 서버가 정보를 일반 JSON 객체로 보낼 수 없는 이유와 이를 `토큰`으로 변환해야 하는 이유에 대해서 정리해보겠습니다.

인증 서버가 일반 JSON으로 정보를 전송한다면, 클라이언트 애플리케이션의 API는 자신이 받는 내용이 정확한지를 검증할 방법이 없습니다. 악의적인 공격자가 예를 들어 사용자 ID를 변경할 수 있으며, 애플리케이션의 API는 그러한 변경 사실을 알 방법이 없습니다.

이러한 보안 문제로 인해, 인증 서버는 이 정보를 클라이언트 애플리케이션이 검증할 수 있는 방식으로 전송해야 합니다.   
여기서 '토큰'의 개념이 등장합니다.  

간단히 말해, 토큰은 일부 정보를 안전하게 검증할 수 있는 문자열입니다. 이는 데이터베이스 내의 ID를 가리키는 임의의 알파벳과 숫자의 조합이 될 수도 있고, 클라이언트가 자가 검증할 수 잇는 인코딩된 JSON(JWTs로 알려짐)이 될 수도 있습니다.

<br>

## 📌 JWT의 구조

JWT는 세 부분으로 구성됩니다.

<img width="680" alt="image" src="https://github.com/NextGen-Coders/CS-Study-2024/assets/76567238/87a8d404-d5d3-4c0b-a87a-6739f66f7374">

- 헤더 : 두 부분으로 구성됩니다.
    - 사용되는 서명 알고리즘
    - 토큰 유형
- 페이로드 :페이로드에는 클레임 또는 JSON 개체가 포함됩니다.
- 서명: JSON페이로드의 무결성을 확인하는 데 사용할 수 있는 암호화 알고리즘을 통해 생성된 문자열 입니다.

<img width="604" alt="image" src="https://github.com/NextGen-Coders/CS-Study-2024/assets/76567238/41527d7f-e65b-48c5-89da-e718a3eaed75">

<출처: supertokens>

<br>

## 📌 JWT 동작 방식

<img width="625" alt="image" src="https://github.com/NextGen-Coders/CS-Study-2024/assets/76567238/1754021e-879b-4559-ba3a-1f50dd5c0393">

1. 사용자가 ID와 PW를 입력해서 로그인 요청을 한다.
2. 서버는 회원 DB에 들어가 있는 사용자인지 확인한다.
3. 확인이 되면 서버는 로그인 요청 확인 후, secret key를 통해서 토큰을 발급한다.
4. 이것을 클라이언트에 전달한다.
5. 서비스 요청과 권한을 확인하기 위해 헤더에 JWT 요청을 한다.
6. 데이터를 확인한 후 JWT에서 사용자 정보를 확인한다.
7. 클라이언트 요청에 대한 응답과 요청한 데이터를 전달한다.

<br>

## 📌 JWT의 장점과 단점

### ✅ 장점

- 보안   
    - JWT는 클라이언트나 공격자가 수정하지 못하도록 보호하는 비밀(HMAC) 또는 공개/개인 키 쌍(RSA 또는 ECDSA)을 사용하여 디지털 서명됩니다.
- 클라이언트에만 저장 
    - 서버에서 JWT를 생성하여 클라이언트로 보냅니다. 그런 다음 클라이언트는 모든 요청과 함께 JWT를 제출합니다. 이렇게 하면 데이터베이스 공간이 절약됩니다.
- 효율적/상태 비저장 
    - 데이터베이스 조회가 필요하지 않으므로 JWT를 빠르게 확인할 수 있습니다. 
    - 이는 대규모 분산 시스템에서 특히 유용합니다.
    - 마이크로 서비스가 많을 때 사용하면 좋습니다.

### ❗️ 단점

- 취소 불가능
    - 자체 포함된 특성과 상태 비저장 확인 프로세스로 인해 JWT가 자연스럽게 만료되기 전에 취소하는 것이 어려울 수 있습니다.
    - 따라서 사용자를 즉시 차단하는 등의 조치는 쉽게 구현뒬 수 없습니다. 
        - jwt를 탈취 당하면 조치가 어렵습니다.  
        - JWT 블랙리스트를 만들어서 보안을 강화하는 방법이 있지만 이렇게 하면 세션방식과 큰 차이가 없게 됩니다.
        - 그나마 보완할 수 있는 것은 토큰 만료시간을 짧게 잡는 것 입니다.

요약하면 JWT는 사용자를 즉시 차단하는 등의 작업이 필요하지 않은 대규모 앱에 가장 유용합니다.

<br>
<br>

---


### 📚 Reference

- [JWT - Json Web Token](https://www.daleseo.com/jwt/)
- [알고 쓰자, JWT(Json Web Token)](https://velog.io/@chuu1019/%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-JWTJson-Web-Token)
- [https://docs.flutterflow.io/data-and-backend/firebase/authentication/jwt-token](https://docs.flutterflow.io/data-and-backend/firebase/authentication/jwt-token)
- [Introduction to JSON Web Tokens](https://jwt.io/introduction)
- [Understanding JSON Web Tokens (JWT): A Secure Approach to Web Authentication](https://medium.com/@extio/understanding-json-web-tokens-jwt-a-secure-approach-to-web-authentication-f551e8d66deb)
