# 📡 프록시 서버

<br>

## 📌 목차
1. 프록시 서버란?
2. 특징
3. 동작 원리
4. 필요 이유
5. 종류

<br>

## 🔄 프록시 서버란?
### ⚪ Proxy란?

- Proxy는 사전적 의미로 "대리" 하는 것을 뜻한다.

- 컴퓨터 과학적인 의미로는 프로토콜 상에서 무엇인가를 대신하는 것을 뜻한다.


### ⚪ Proxy 서버

- 프록시 서버는 클라이언트에서 서버로 접속을 할 때 직접적으로 접속하지 않고 `중간에 대신 전달해주는 서버`를 의미한다.

- 프록시 서버는 클라이언트와 서버 사이에서 중개인 역할을 한다고 보면 된다.

- 프록시 서버란 시스템에 방화벽을 가지고 있는 경우 외부와의 통신을 위해 만들어 놓은 서버라는 의미도 있다.

- 프록시 서버는 프록시 서버에 `요청된 내용들을 캐시를 이용하여 저장`한다.

- 프록시 서버에 요청된 내용들을 캐시를 이용하여 저장하면 전송시간도 절약할 수 있다.

- 동시에 불필요하게 외부와의 연결을 하지 않아도 된다는 장점을 가지게 된다. 

- 또한 외부와의 트래픽을 줄이게 됨으로써 `네트워크 병목현상을 방지`할 수 있다.

<br>

![imgae](https://github.com/devSquad-study/2023-CS-Study/raw/main/Network/img/proxyServerImg.png)

<br>

## ✔ 특징
- pc와 외부 인터넷 사이의 징검다리 역할이다. 

- 중계를 해주기 때문에 **외부 인터넷에서는 클라이언트의 정보를 알 수 없다.**

- 외부 인터넷의 **내부 침입을 막는 방화벽과 관련이 있다.**

- **프록시 서버는 캐시 기능이 있다.**

- IP를 바꾸기 위한 용도로 많이 사용되고 있다.

- A Client가 B Proxy에 접근하여 C 인터넷(google.com)에 접속하는 방식이다. 

<br>

## ♻ 동작 원리
1. 클라이언트에서 프록시 서버로 전달할 요청을 보낸다.

2. 프록시 서버 내에 `요청에 해당하는 데이터를 가지고 있는지 체크`한다. 

3. 가지고 있는 경우 서버에 데이터가 `최신인지 체크하고 최신이 아닌 경우 갱신할 부분만 요청`한다. 

4. 가지고 있지 않은 경우 아래의 과정을 진행한다. 

5. 프록시 서버가 클라이언트의 IP 주소를 자체 IP 주소로 바꿉니다.

6. 프록시 서버는 `클라이언트로부터 전달 받은 요청을 서버에 요청`한다.

7. 서버는 요청을 처리하고 요청에 맞게 `응답 데이터를 프록시 서버로 전달`한다.

8. 프록시 서버는 서버로부터 전달 받은 `응답 데이터를 클라이언트에 전달`한다.

<br>

## ⁉ 필요 이유 
클라이언트에서 서버로 곧바로 요청과 데이터를 주고 받지 않고 프록시 서버를 거쳐서 주고 받는 이유가 무엇일까?

거기엔 몇 가지 이유가 있다.

### 1️⃣ 보안 : 요청과 응답의 필터링

- 프록시 서버를 이용하지 않으면 서버의 주소가 쉽게 노출되고 다른 익명의 사용자가 서버로 접근하기 쉬워진다.

- 프록시 서버가 `중간에 경유하게 되면 서버의 IP 숨기는 것 가능`하다.

- 서버의 IP를 숨기는 것이 가능하고 이는 외부로부터 위험을 막아주는 역할을 한다.

- 프록시 서버를 통해 한 단계의 보안을 더 할 수 있기 때문에 컴퓨터 보안을 유지할 수 있다.

- 프록시 서버를 `방화벽으로 사용하기도한다`. (프록시 방화벽)

    ```
    방화벽 (firewall)

  보안 규칙에 기반한, 들어오고 나가는 네트워크 트래픽을 모니터링하고 제어하는 네트워크 보안 시스템이다.

  신뢰할 수 있는 내부 네트워크, 신뢰할 수 없는 외부 네트워크 간의 장벽을 구성한다.
  ```

### 2️⃣ 프록시 방화벽

- 세션에 포함되어 있는 `정보의 유해성을 검사`하기 위함이다.

- 방화벽에서 세션을 종료하고 새로운 세션을 형성하는 방식이다.

- 출발지에서 목적지로 가는 세션을 가로채어서 출발지에서 방화벽까지의 세션과 방화벽에서 목적지까지 두 세션으로 만든 다음 하나의 세션에서 다른 세션으로 정보를 넘겨주기 전 검사를 수행하는 형태다.

- `패킷 필터에 비해 많은 부하를 주어서 속도는 느리지만 더 많은 검사 가능`하다.

- 프로토콜 변경 등 추가적인 기능 수행 가능하다.

<br>

![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbM11nl%2Fbtrzhro1H4T%2FEFKncXbsncbdBVh0H39oQk%2Fimg.png)

<br>

### 3️⃣ 분산 처리 : 캐시 사용 로드 밸런싱

- 프록시 서버 중 일부는 프록시 서버에 `요청된 내용을 캐시를 사용해 저장`해둔다.

- 캐시에 저장된 내용에 대한 재요청은 서버 따로 접속 필요 없다.

- 따라서 `전송 시간 절약`, 외부 트래픽 줄임으로써 `병목현상 방지`할 수 있다.

<br>

![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcD7KNX%2FbtrzfBsqnq1%2Fbi5GmwozIszlhjgPbUF9v1%2Fimg.png)

<br>

### 4️⃣ 우회

- 클라이언트 1,2,3이 인터넷과 직접적으로 통신하게 되면 IP가 직접적으로 인터넷에 드러나게된다. 이는 보안적으로 취약할 수 밖에 없다.

- 중간에 프록시 서버를 둔다면, `인터넷 서버는 프록시 서버와 통신하기 때문에 클라이언트들의 IP를 알 수 없게 된다`.

- 이와 같이 IP 주소를 감출 수가 있기 때문에 `어느 곳에서 접속한지를 숨길 수가 있다`.

- 이는 곧 IP를 통해 접속을 감지하는 사이트를 프록시 서버를 통해 우회할 수가 있다.

- 이는 보안적인 취약점을 커버할 수 있게 되며, 특정 서버를 우회하여 들어갈 수 있도록 허용해주는 역할도 하게 된다.

<br>

![image](https://github.com/devSquad-study/2023-CS-Study/raw/main/Network/img/proxyServer_detour.png)

<br>

### 5️⃣ ACL : 사이트 접근 정책

- ACL은 개체나 개체 속성에 적용되어 있는 허가 목록이다.  

- 이 목록은 누가 또는 무엇이 객체 접근 허가를 받는지, 어떠한 작업이 객체에 수행되도록 허가를 받을지를 지정하고 있다.

- 프록시 서버에 `접속할 수 있는 범위를 설정하는 옵션`이다. 

- `사이트 접근에 대한 접근 정책을 정의할 수 있다`.

- 또한 사용률을 기록하고 검사하기 위해 사용할 수 있다.

<br>

## ✨ 종류
### ➡ 포워드 프록시(Forward Proxy)

- Forward Proxy는 보안을 위해 사용되는 방식이다.

- 즉, `클라이언트에서 요청을 할 때` 직접 요청하는 것이 아닌 프록시 서버를 거치는 방식이 바로 Forward Proxy다.

- Forward Proxy 서버를 사용하면 서버는 실제 클라이언트를 인식하지 못하고 프록시를 클라이언트라고 생각한다.

- 서버에서 받은 IP는 클라이언트의 IP가 아니라 프록시 서버의 IP이기 때문에 `서버는 클라이언트가 누군지 알 수 없다`. 

- `Internet 입장에서 클라이언트가 감춰진다`.

- Forward Proxy 프라이빗 네트워크 데이터를 외부인으로부터 보호하고 익명화한다.

- 이 방식은 대역폭 사용을 감소시킬 수 있다.

- 접근 정책 구현에 있어서 다루기 쉬우면서도 비용이 저렴하다는 장점이 있다. 

- 사용자의 정해진 사이트만 연결할 수 있는 등 웹 사용환경을 제한할 수 있으므로 기업 환경 등에서 많이 사용된다.

    #### ⚪ 특징

    1. 캐싱 : Forward Proxy는 정적 데이터를 프록시 서버에 저장해두고, **동일한 요청이 올 경우 서버까지 가지 않고, 프록시 서버를 통해 처리할 수 있는 캐싱 역할을 할 수 있다.**

    2. 보안 : 사내망에서 프록시 서버를 통해서 **정해진 사이트만 연결 할 수 있도록 설정할 수 있다.**

<br>

![image](https://camo.githubusercontent.com/0911df4011fa9cac40b39f7553a849a4a1211f6c5824b7fdbc7a65aaf3ebdd57/68747470733a2f2f696d616765732e76656c6f672e696f2f696d616765732f616e6e6d6a2f706f73742f62396439643539352d323762622d343438312d613635342d6432633465336131313331372f696d6167652e706e67)

<br>


### ⬅ 리버스 프록시(Reverse Proxy)

- 왜 사용하는가하면 프록시 서버를 인터넷 리소스 또는 인트라넷 리소스 앞에 위치시키며, 보안을 위해서 사용한다.

- Reverse Proxy는 Forward Proxy와 반대로 `서버에서 응답을 보낼 때` 클라이언트로 직접 데이터를 전달하지 않고 프록시 서버를 거치는 방식이 바로 Reverse Proxy다.

- 클라이언트가 인터넷에 데이터를 요청하면, Reverse Proxy가 이 요청을 받아 내부 서버에서 데이터를 받은 후 클라이언트에 전달하는 방식이다. 

- 클라이언트들은 프록시 서버에 연결된 것 인식하지 않고, `최종 사용자가 요청 리소스에 직접 접근하는 것처럼 느낀다`. 

- 클라이언트는 내부 서버에 대한 정보를 알 필요 없이, Reverse Proxy에만 요청하면 된다. 

- `Internet 입장에서 서버가 감춰진다`.

- Reverse Proxy는 들어오는 모든 인터넷 트래픽이 서버에 도달하기 전에 모니터링하고 차단한다. 

- Reverse Proxy는 방문자 트래픽을 검사하여 무단 활동이 있는지 확인하고 특정 트래픽 소스를 차단하도록 역방향 프록시를 구성할 수 있다. 

- Reverse Proxy는 서버에 보안, 익명성 및 트래픽 분산 관리 계층을 추가한다.

- Reverse Proxy는 SSL 암호화에 좋다. 

  - 본래 서버가 클라이언트들과 통신을 할때 SSL(or TSL)로 암호화, 복호화를 할 경우 비용이 많이 들게 된다.
  
  - 그러나 Reverse Proxy를 사용하면 들어오는 요청을 모두 복호화하고 나가는 응답을 암호화해주므로 클라이언트와 안전한 통신을 할수 있으며 본래 서버의 부담을 줄여줄 수 있다.

- 로드 밸런싱이나 서버 확장 등에 유리하다. 

    #### ⚪ 특징

    1. 로드밸런싱 : Reverse Proxy 뒤에 여러 개의 WAS를 둠으로써, end-point마다 역할을 구분하여 **사용자 요청을 분산시킬 수 있다.**

    2. 보안 : **서버에 직접 접근하는 것을 막기 위해** DMZ 같은 네트워크에 Reverse Proxy를 구성하여 접근하도록 할 수 있다.

    3. 필터링 : 웹 서버 앞단에서 **악의적인 요청을 필터링하는 것이 가능**하다.

    4. 성능 향상 : **데이터를 압축해주거나, 정적 컨텐츠들을 캐싱**하며 성능 향상에 기여한다.

    5. 무중단 서비스 : 한 서버에 장애가 발생했을 때, **다른 서버를 통해 서비스를 제공할 수 있다.**

<br>

![image](https://camo.githubusercontent.com/944621ef8dccac5b7e3362eeb382a7d38e55af893d056e5e021372ef7994b8b2/68747470733a2f2f696d616765732e76656c6f672e696f2f696d616765732f616e6e6d6a2f706f73742f36646531376435622d393361662d346235642d393464662d6537353431356238613530662f696d6167652e706e67)

<br>

### ⚡ 차이점

1. **End Point**
    - Forward : 클라이언트가 요청하는 End Point가 실제 서버 도메인, 프록시는 둘 사이의 통신 담당

    - Reverse : 클라이언트가 요청하는 End Point가 프록시 서버 도메인, 실제 서버 정보 알 수 없음
  
2. **감추어지는 대상**
    - Forward : `클라이언트`
    
    - Reverse : `서버`
  
3. **통신 대상**
    - Forward : 클라이언트와 Proxy서버가 통신하여 인터넷을 통해 외부에서 데이터 가져옴
    
    - Reverse : Proxy 서버와 내부망 서버가 통신하여 인터넷을 통해 요청이 들어오면 Proxy 서버가 받아 응답해줌
  
<br>

## 📍 references
- [동작 원리, 필요 이유, 종류](https://github.com/devSquad-study/2023-CS-Study/blob/main/Network/network_proxy_server.md)

- [프록시 서버, 종류](https://github.com/NKLCWDT/cs/blob/main/Network/%ED%94%84%EB%A1%9D%EC%8B%9C.md)

- [프록시 서버, 특징, 필요 이유, 종류](https://velog.io/@jangwonyoon/Proxy-Server%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EB%9E%80)

- [프록시 서버, 동작 원리, 필요 이유, 종류](https://fomaios.tistory.com/entry/Network-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EB%9E%80-feat-%ED%95%84%EC%9A%94%ED%95%9C-%EC%9D%B4%EC%9C%A0-What-is-a-Proxy-server)

- [동작 원리, 종류](https://aws.amazon.com/ko/compare/the-difference-between-proxy-and-vpn/)